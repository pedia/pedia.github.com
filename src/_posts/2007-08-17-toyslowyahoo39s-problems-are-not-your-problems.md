---

# [è½¬] YSlow: Yahoo&#39;s Problems Are Not Your Problems
2007-08-17 13:06:50


---


<p>I first saw <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html">Yahoo's 13 Simple Rules for Speeding Up Your Web Site</a> referenced in a <a target=_blank target="_blank" href="http://www.skrenta.com/2007/05/14_rules_for_fast_web_pages_by_1.html">post on Rich Skrenta's blog</a> in May. It looks like there were originally 14 rules; one must have fallen off the list somewhere along the way.</p>
<p></p>
<ol><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#num_http">Make Fewer HTTP Requests</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#cdn">Use a Content Delivery Network</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#expires">Add an Expires Header</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#gzip">Gzip Components</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#css_top">Put CSS at the Top</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#js_bottom">Move Scripts to the Bottom</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#css_expressions">Avoid CSS Expressions</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#external">Make  and CSS External</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#dns_lookups">Reduce DNS Lookups</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#minify">Minify </a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#redirects">Avoid Redirects</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#js_dupes">Remove Duplicate Scripts</a></li><li><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#etags">Configure ETags</a></li></ol><p>It's solid advice culled from the excellent <a target=_blank target="_blank" href="http://www.yuiblog.com/">Yahoo        User Interface blog</a>, which will soon be packaged into a <a target=_blank target="_blank" href="http://www.amazon.com/exec/obidos/ASIN/0596529309/codinghorror-20">            similarly excellent book</a>. It's also <a target=_blank target="_blank" href="http://www.web2expo.com/presentations/webex2007/souders_steve.ppt">                available as a powerpoint presentation</a> delivered at the Web 2.0 conference.</p>
<p>        I've also covered similar ground in my post, <a target=_blank target="_blank" href="http://www.codinghorror.com/blog/archives/000807.html">            Reducing Your Website's Bandwidth Usage</a>.</p>
    <p>        But before you run off and implement all of Yahoo's solid advice, <strong>consider the audience</strong>. These are rules from Yahoo, which <a target=_blank target="_blank" href="http://www.alexa.com/site/ds/top_500">according to Alexa</a> is one of the <strong>top three web properties in the world</strong>. And Rich's company, <a target=_blank target="_blank" href="http://topix.net/">Topix</a>,is no slouch either-- they're in the top 2,000. It's only natural thatRich would be keenly interested in Yahoo's advice on how to <b>scale a website to millions of unique users per day.</b></p>
<p>To help others implement the rules, Yahoo created a <a target=_blank target="_blank" href="http://addons.mozilla.org/firefox/addon/1843">FireBug</a> plugin, <a target=_blank target="_blank" href="http://developer.yahoo.com/yslow/">YSlow</a>.This plugin evaluates the current page using the 13 rules and providesspecific guidance on how to fix any problems it finds. And best of all,the tool rates the page with a score-- a <i>score!</i> There's nothing we love more than <a target=_blank target="_blank" href="http://www.codinghorror.com/blog/archives/000717.html">boiling down pages and pages of complicated advice to a simple, numeric score</a>. Here's my <s>report card</s> score for yesterday's post.</p>
<p><img alt="yslow performance score" src="http://www.codinghorror.com/blog/images/yslow-performance-score.png" border="0" height="379" width="394"></p>
<p>To understand the scoring, you have to dissect the weighting of the individual rules, <a target=_blank target="_blank" href="http://codeclimber.net.nz/archive/2007/08/15/Dissecting-YSlow.aspx">as Simone Chiaretta did</a>:</p>
<p></p>
<table cellpadding="4" cellspacing="4" width="700"><tbody><tr><td valign="top"><b><font color="red">Weight 11</font></b></td><td valign="top">3. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#expires">Add an Expires Header</a><br />
    4. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#gzip">GZip Components</a><br />
13. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#etags">Configure ETags</a></td></tr><tr><td valign="top"><b><font color="firebrick">Weight 10</font></b></td><td valign="top">2. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#cdn">Use a Content Delivery Network</a><br />
    5. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#css_top">Put CSS at the Top</a><br />
    10. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#minify">Minify </a><br />
11. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#redirects">Avoid Redirects</a></td></tr><tr><td valign="top"><b>Weight 5</b></td><td valign="top">9. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#dns_lookups">Reduce DNS Lookups</a><br />
6. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#js_bottom">Move Scripts to the Bottom</a><br />
12. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#js_dupes">Remove Duplicate Scripts</a></td></tr><tr><td valign="top"><b>Weight 4</b></td><td valign="top">1. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#num_http">Make Fewer Requests</a> (CSS)<br />
1. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#num_http">Make Fewer Requests</a> (JS)</td></tr><tr><td valign="top"><b>Weight 3</b></td><td valign="top">1. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#num_http">Make Fewer Requests</a> (CSS background images)</td></tr><tr><td valign="top"><b>Weight 2</b></td><td valign="top">7. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#css_expressions">Avoid CSS Expressions</a></td></tr></tbody></table><p>    My YSlow score of 73 is respectable, but I've already made some changes to accommodate    its myriad demands. To get an idea of how some common websites score, <a target=_blank target="_blank" href="http://codeclimber.net.nz/archive/2007/08/05/How-Slow-is-your-site-How-to-improve-the-performance.aspx">        Simone ran YSlow on    a number of blogs</a> and recorded the results:</p>
    <ul><li>Google: A (99) </li><li>Yahoo Developer Network blog : D (66) </li><li>Yahoo! User Interface Blog : D (65) </li><li>Scott Watermasysk : D (62) </li><li>Apple : D (61) </li><li>Dave Shea's mezzoblue : D (60) </li><li>A List Apart : F (58) </li><li>Steve Harman : F (54) </li><li>Coding Horror : F (52) </li><li>Haacked by Phil : F (36) </li><li>Scott Hanselman's Computer Zen : F (29)</li></ul>    <p>        YSlow is a convenient tool, but <strong>either the web is full of terribly inefficient            web pages</strong>, or there's something wrong with its scoring. I'll get to        that later.</p>
    <p>The Stats tab contains a summary of the total size of your downloadedpage, along with the footprint with and without browser caching. One ofthe key findings from Yahoo is that <a target=_blank target="_blank" href="http://yuiblog.com/blog/2007/01/04/performance-research-part-2/">        40 to 60 percent of daily visitors have an empty cache</a>. So it behooves you    to optimize the size of <em>everything</em> and not rely on client browser caching to save to you    in the common case.<br />
<img alt="yslow stats" src="http://www.codinghorror.com/blog/images/yslow-stats.png" border="0" height="318" width="401"><br />
</p>
<p>    YSlow also breaks down the statistics in much more detail via the Components tab.    Here you can see a few key judgment criteria for every resource on your page...</p>
    <ul><li>Does this resource have an explicit expiration date?</li><li>Is this resource compressed?</li><li>Does this resource have an ETag?</li></ul>    <p>        ... along with the absolute sizes.</p>
<img alt="yslow components" src="http://www.codinghorror.com/blog/images/yslow-components.png" border="0" height="284" width="700"><p>YSlow is a useful tool, but it can be dangerous in the wrong hands.Software developers love optimization. <a target=_blank target="_blank" href="http://www.flounder.com/optimization.htm">Sometimes too much</a>.</p>
<p>    There's some good advice here, but there's also <strong>a lot of advice that only makes        sense if you run a website that gets millions of unique users per day</strong>.    Do you run a website like that? If so, what are you doing reading this instead of    flying your private jet to a Bermuda vacation with your trophy wife? The rest of    us ought to be a little more selective about the advice we follow. Avoid the temptation    to blindly apply these "top (x) ways to (y)" lists that are so popular on Digg and    other social networking sites. Instead, read the advice critically and think about    the consequences of implementing that advice.<br />
</p>
<p>        If you fail to read the Yahoo advice critically, you might make your site <em>slower</em>,        as <a target=_blank target="_blank" href="http://www.haacked.com/archive/2007/08/13/speed-up-your-pages-and-improve-your-yslow-score-with.aspx">            as Phil Haack unfortunately found out</a>. While many of these rules are bread-and-butter        HTTP optimization scenarios, it's unfortunate that a few of the highest-weighted        rules on Yahoo's list are downright dangerous, if not flat-out <i>wrong</i> for smaller web        sites. And when you define "smaller" as "smaller than Yahoo", that's.. well, almost        everybody. So let's take a critical look at the most problematic heavily weighted advice        on Yahoo's list.</p>
    <p>        <strong><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#cdn">Use a Content            Delivery Network</a> (Weight: 10)</strong></p>
    <p>        If you have to ask how much <a target=_blank target="_blank" href="http://en.wikipedia.org/wiki/Content_Delivery_Network">            a formal Content Delivery Network</a> will cost, you can't afford it. It's more        effective to think of this as outsourcing the "heavy lifting" on your website--        eg, any large chunks of media or images you serve up -- to external sites that are        much better equipped to deal with it. This is one of the most important bits of        advice I provided in <a target=_blank target="_blank" href="http://www.codinghorror.com/blog/archives/000807.html">            Reducing Your Website's Bandwidth Usage</a>. And using a CDN, below a reasonably Yahoo-esque traffic volume, can even <a target=_blank target="_blank" href="http://www.haacked.com/archive/2007/08/13/speed-up-your-pages-and-improve-your-yslow-score-with.aspx">            slow your site down</a>.</p>
    <p>        <strong><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#etags">Configure            ETags</a> (Weight: 11)</strong></p>
    <p>        ETags are a checksum field served up with each server file so the client can tell if the server resource is different        from the cached version the client holds locally. Yahoo recommends turning ETags        off because they cause problems on server farms due to the way they are generated        with machine-specific markers. So unless you run a server farm, you should ignore        this guidance. It'll only make your site perform worse because the client will have        a more difficult time determining if its cache is stale or fresh. It is possible        for the client to use the existing last-modified date fields to determine whether        the cache is stale, but <a target=_blank target="_blank" href="http://perl.apache.org/docs/general/correct_headers/correct_headers.html#Last_Modified">            last-modified is a weak validator</a>, whereas <a target=_blank target="_blank" href="http://perl.apache.org/docs/general/correct_headers/correct_headers.html#Entity_Tags">                Entity Tag (ETag) is a strong validator</a>. Why trade strength for weakness?</p>
    <p>        <strong><a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html#expires">Add an Expires            Header</a> (Weight: 11)</strong></p>
<p>    This isn't bad advice, per se, but it can cause huge problems if you get it wrong.    In Microsoft's IIS, for example, the Expires header is always turned off by default,    probably for that very reason. By setting an Expires header on HTTP resources, you're    telling the client to <em>never check for new versions of that resource</em>-- at    least not until the expiration date on the Expires header. When I say never, I mean    it -- the browser won't even <em>ask</em> for a new version; it'll just assume its    cached version is good to go until the client clears the cache, or the cache reaches    the expiration date. Yahoo notes that they change the filename of these resources    when they need them refreshed.</p>
<p>All you're really saving here is the cost of the    client pinging the server for a new version and getting a 304 not modified header    back in the common case that the resource hasn't changed. That's not    much overhead.. unless you're Yahoo. Sure, if you have a set of images or scripts    that almost <em>never</em>    change, definitely exploit client caching and turn on the <a target=_blank target="_blank" href="http://www.mnot.net/cache_docs/#CACHE-CONTROL">Cache-Control header</a>. Caching is critical to browser performance; every web developer should have <a target=_blank target="_blank" href="http://www.mnot.net/cache_docs/">a deep understanding of how HTTP caching works</a>.But only use it in a surgical, limited way for those specific foldersor files that can benefit. For anything else, the risk outweighs thebenefit. It's certainly not something you want turned on as a blanketdefault for your entire website.. unless you like changing filenamesevery time the content changes.</p>
<p>        I don't mean to take anything away from Yahoo's excellent guidance. <a target=_blank target="_blank" href="http://developer.yahoo.com/performance/rules.html">            Yahoo's 13 Simple Rules for Speeding Up Your Web Site</a> and the companion        <a target=_blank target="_blank" href="http://addons.mozilla.org/firefox/addon/1843">FireBug</a> plugin, <a target=_blank target="_blank" href="http://developer.yahoo.com/yslow/">YSlow</a>, are outstanding        resources for the entire internet. By all means, read it. Benefit from it. Implement it. I've been        <a target=_blank target="_blank" href="http://www.codinghorror.com/blog/archives/000059.html">banging away on the            benefits of GZip compression for years</a>.</p>
    <p>        But also <strong>realize that Yahoo's problems aren't necessarily your problems</strong>. There is no such thing as one-size-fits-all guidance. Strive to <i>understand</i> the advice first, then implement the advice that makes sense for your specific situation. </p>
<p></p>
[advertisement] <a target=_blank target="_blank" href="http://www.axosoft.com/?gad=CJ7Ymu4CEgg7vGiG48xTJBjw16__AyC-n7An" rel="nofollow">Axosoft's OnTime 2007</a>allows software development teams to collaborate and ship software ontime. It manages projects hierarchically, tracking defects,requirements, tasks, and help desk incidents in one place. Hosted orinstalled. Windows or Web. Free SDK and <a target=_blank target="_blank" href="http://www.axosoft.com/?gad=CJ7Ymu4CEgg7vGiG48xTJBjw16__AyC-n7An" rel="nofollow">Free single-user license</a>.<p><br />
</p>
<p><br />
</p>
