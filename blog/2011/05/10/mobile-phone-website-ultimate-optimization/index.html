
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>手机网站的终极优化 - HeartOutside</title>
  <meta name="author" content="Ken">

  
  <meta name="description" content="在中国特殊国情下，手机网络速度低下，大部分还是GPRS，每个请求几乎都要2s :-(。
并且手机浏览器能同时建立的连接数也低一些 Connections Per HostnameMax Connections
Android 244
Android 3635
iPhone 3655
iPhone &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://log.heartoutside.com/blog/2011/05/10/mobile-phone-website-ultimate-optimization">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="HeartOutside" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">HeartOutside</a></h1>
  
    <h2>not yet</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:log.heartoutside.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">手机网站的终极优化</h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-05-10T11:34:00+08:00" pubdate data-updated="true">May 10<span>th</span>, 2011</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>在中国特殊国情下，手机网络速度低下，大部分还是GPRS，每个请求几乎都要2s :-(。<br />
并且手机浏览器能同时建立的连接数也低一些</p>

<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody>
<tr><td></td><td>Connections Per Hostname</td><td>Max Connections</td></tr>
<tr><td>Android 2</td><td>4</td><td>4</td></tr>
<tr><td>Android 3</td><td>6</td><td>35</td></tr>
<tr><td>iPhone 3</td><td>6</td><td>55</td></tr>
<tr><td>iPhone 4</td><td>4</td><td>30</td></tr>
<tr><td>Nokia 97</td><td>7</td><td>7</td></tr>
<tr><td>Opera Mobile 10</td><td>2</td><td>4</td></tr>
<tr><td>Opera Mobile 11</td><td>2</td><td>5</td></tr>
</tbody></table>


<p>下图是一个典型的手机访问的 waterfall<br />
<img src="/pic/1_waterfall.png" title="mobile waterfall" alt="waterfall" /></p>

<p>还有手机对cache的支持也比较有限<br />
<img border="0" height="220" src="/pic/mobile-cache.png" width="400" /></p>

<p>显然减少每个页面连接数是非常非常有价值的。
<a href="http://en.wikipedia.org/wiki/Data_URI_scheme">Data URI</a>技术非常适合用在这个地方，支持的浏览器也还是不少的。<br /></p>

<ul><li>&nbsp; &nbsp; Firefox 2+</li>
<li>&nbsp; &nbsp; Opera 7.2+ &nbsp;data URIs must not be longer than 4100 characters</li>
<li>&nbsp; &nbsp; Chrome (all versions)</li>
<li>&nbsp; &nbsp; Safari (all versions)</li>
<li>&nbsp; &nbsp; Internet Explorer 8+ data URIs must be smaller than 32k</li>
<li>&nbsp; &nbsp; Internet Explorer 9 does not have 32KiB limitation and allowed in broader elements</li>
</ul>


<p>手机浏览器<b>可能</b>不支持的有</p>

<ul><li>IE Mobile all 6.12-8.12</li>
<li>Nokia 51/66/71/82/95</li>
<li>PlayStation Portable 2.00</li>
<li>Samsung SGHI560</li>
<li>WebPilot 8.7</li>
<li>Obigo 7</li>
<li>Opera 5/6/7 不支持</li>
<li>Blackberry 6/8330/8520/9300/9700</li>
</ul>


<p></p>

<p>以上未列出的系统应该都支持，如：Nokia 后期的系统，IE 8/9，Android，iPhone。</p>

<p>3g.renren.com 上的Logo的HTML代码为</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;img alt="renren" src="http://a.xnimg.cn/wap/logo.gif" /&gt;</span></code></pre></td></tr></table></div></figure>


<p>用Data URI代码如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;img alt="renren" src="data:image/gif;base64,R0lGODlhTAAWANUAAJXA4ou63ht1u9nq+L3Y7VGXzKBSZeTx+8z
</span><span class='line'>i83Os1u5ANuPu+Pr8/mun1TeHxMfe8ACGytzr93uw2NLm9v3+//7+/63O6ff7/i6BwcdGS+v0+wB8xefy+gBptUCMxu72/Pz
</span><span class='line'>9/vT5/Q9vuNbp+PH4/KDH5d3s+Ch/wA9ttfH3/Pr7/gBerNzr+bDR6+/1+gB0vh94vF2f0PT6/UyTymCf0Nbn9jxdlKnM5gB
</span><span class='line'>jsABuuwBhr1pYhNfq+Nfp+ABms////yH5BAAAAAAALAAAAABMABYAAAb/wJ9wSCwaj8ikcnlkQCAVCqXCrFqv1UrlsoGAvlr
</span><span class='line'>KbxotT6Vnshl91pbDb3SYLIXLo3cQF8JQMb5fGgEYHkI+BSWAICWEQh4YiYqSID4SihSSHh6SEj6en54iloAhLxAXF35+DzC
</span><span class='line'>ehT+fHhoPGK6OnhgPDLu7Kn4Elby9wyIevrydEsrLEiI+wiQ5EDIhqBcPzrawnw4CsbehD9bjwBLj5xc+HuedMxwNHjcXMbX
</span><span class='line'>jHx0QKSQhIQet39s8ZTAA0AMoDNT4KQTgowG/hApD1PABI2KITj5mZLvxKQQ1GRrwffhAIgVGgJ92KFBgQ5tBUABK6tMXw4c
</span><span class='line'>ImSRK5iTB0AcB/30lO9Ws9KnmTBIcfEDQoGHkP5SeDKwkqA4ct5FYTVD0AQCr1w8YWsXw2mmCpw/tOrlwMfIADggcOGiIAMp
</span><span class='line'>TAiG1fKxUkEFbgbo+mApu4MOCCBERBAsu4SOBAx8tBCdobPexCMKKF+iAcOAABwuASwih4WmvArtCAgCOGxe0u8kOWMcdIAL
</span><span class='line'>GANAiBsSd7COss1rOZC9YAWHBggOg65oQwljvXk8IhGit2xn54RqdaznAfqBGLQudCcMgcGCyCAsWHIio8a/6ARPEF5gwwaI
</span><span class='line'>ujR8uhLTa2/dV/pefmIAAYSK0wAILJhDgjAAtBOBMAPMheIJNARCGIH0ESBDAYxGyMP8AcfMNMMCEoeQXQHTASKWAASJEZ4F
</span><span class='line'>oJmSjzgAInMCgiDgScMIJCPwVAI4i9lggYUCOGAqQPaywAY48qGZTdC7AUABzNqyEgmg/eACDEMn5UAIPPCCAgIg8DABmkCI
</span><span class='line'>SUOSZYxJQAplmtlBCCWOWOUANSpI5wggnYBDdD6R5yaUBBjyQmicSCIEADA6MwEMPPjjgQE0OEHZIA4dJIIAIPYnwJQKPVRp
</span><span class='line'>pT5440MOjPUyg5KmoInDBoaEQIIQLDDAHCpYXINDDrod0YpADBXSCKQDdnPBYCZX2UAKPkLYgqQMMteDDrruqugGrp/YwQAh
</span><span class='line'>/1RXAB9qiBVgCJAxALaQIMBaVQwMFNMBYA6Y6cEIDqvXQgLslCMCrs5IyNsK01Kr6gqOoUltCAd74cEIMBJxLQAwknoDIubz
</span><span class='line'>u+lhD7jZkKgDeEGYvpshGSimxjEF6rsCs8jACxSsXTPGuj7r8cg+OZjuzzDRTjPPJOLyQcswzU7ty0DivPHTNRAet884TdOA
</span><span class='line'>ztUArPfTNLxu9K9JUKw21zCpPkMMGQQAAOw==" /&gt;</span></code></pre></td></tr></table></div></figure>


<p>是有点长，效果为<img alt="renren" src="data:image/gif;base64,R0lGODlhTAAWANUAAJXA4ou63ht1u9nq+L3Y7VGXzKBSZeTx+8zi83Os1u5ANuPu+Pr8/mun1TeHxMfe8ACGytzr93uw2NLm9v3+//7+/63O6ff7/i6BwcdGS+v0+wB8xefy+gBptUCMxu72/Pz9/vT5/Q9vuNbp+PH4/KDH5d3s+Ch/wA9ttfH3/Pr7/gBerNzr+bDR6+/1+gB0vh94vF2f0PT6/UyTymCf0Nbn9jxdlKnM5gBjsABuuwBhr1pYhNfq+Nfp+ABms////yH5BAAAAAAALAAAAABMABYAAAb/wJ9wSCwaj8ikcnlkQCAVCqXCrFqv1UrlsoGAvlrKbxotT6Vnshl91pbDb3SYLIXLo3cQF8JQMb5fGgEYHkI+BSWAICWEQh4YiYqSID4SihSSHh6SEj6en54iloAhLxAXF35+DzCehT+fHhoPGK6OnhgPDLu7Kn4Elby9wyIevrydEsrLEiI+wiQ5EDIhqBcPzrawnw4CsbehD9bjwBLj5xc+HuedMxwNHjcXMbXjHx0QKSQhIQet39s8ZTAA0AMoDNT4KQTgowG/hApD1PABI2KITj5mZLvxKQQ1GRrwffhAIgVGgJ92KFBgQ5tBUABK6tMXw4cImSRK5iTB0AcB/30lO9Ws9KnmTBIcfEDQoGHkP5SeDKwkqA4ct5FYTVD0AQCr1w8YWsXw2mmCpw/tOrlwMfIADggcOGiIAMpTAiG1fKxUkEFbgbo+mApu4MOCCBERBAsu4SOBAx8tBCdobPexCMKKF+iAcOAABwuASwih4WmvArtCAgCOGxe0u8kOWMcdIALGANAiBsSd7COss1rOZC9YAWHBggOg65oQwljvXk8IhGit2xn54RqdaznAfqBGLQudCcMgcGCyCAsWHIio8a/6ARPEF5gwwaIujR8uhLTa2/dV/pefmIAAYSK0wAILJhDgjAAtBOBMAPMheIJNARCGIH0ESBDAYxGyMP8AcfMNMMCEoeQXQHTASKWAASJEZ4FoJmSjzgAInMCgiDgScMIJCPwVAI4i9lggYUCOGAqQPaywAY48qGZTdC7AUABzNqyEgmg/eACDEMn5UAIPPCCAgIg8DABmkCISUOSZYxJQAplmtlBCCWOWOUANSpI5wggnYBDdD6R5yaUBBjyQmicSCIEADA6MwEMPPjjgQE0OEHZIA4dJIIAIPYnwJQKPVRppT5440MOjPUyg5KmoInDBoaEQIIQLDDAHCpYXINDDrod0YpADBXSCKQDdnPBYCZX2UAKPkLYgqQMMteDDrruqugGrp/YwQAh/1RXAB9qiBVgCJAxALaQIMBaVQwMFNMBYA6Y6cEIDqvXQgLslCMCrs5IyNsK01Kr6gqOoUltCAd74cEIMBJxLQAwknoDIubzu+lhD7jZkKgDeEGYvpshGSimxjEF6rsCs8jACxSsXTPGuj7r8cg+OZjuzzDRTjPPJOLyQcswzU7ty0DivPHTNRAet884TdOAztUArPfTNLxu9K9JUKw21zCpPkMMGQQAAOw==" /></p>

<p>花了点时间用 Python 120 行代码实现了个代理，没有一个img请求。</p>

<p>附上BrowserScope的关于浏览器的特性
<img border="0" height="400" src="/pic/browser-scope-data-uri.png" width="186" /></p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Ken</span></span>

      








  


<time datetime="2011-05-10T11:34:00+08:00" pubdate data-updated="true">May 10<span>th</span>, 2011</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/mobile/'>mobile</a>, <a class='category' href='/blog/categories/optimization/'>optimization</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://log.heartoutside.com/blog/2011/05/10/mobile-phone-website-ultimate-optimization/" data-via="boostguy" data-counturl="http://log.heartoutside.com/blog/2011/05/10/mobile-phone-website-ultimate-optimization/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2011/04/22/lbs-in-two/" title="Previous Post: LBS的两种实现">&laquo; LBS的两种实现</a>
      
      
        <a class="basic-alignment right" href="/blog/2011/05/11/go-xia-junfeng-second-defence/" title="Next Post: 转：夏俊峰案二审辩护词">转：夏俊峰案二审辩护词 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2012/03/22/mawk-and-gawk/">mawk and gawk</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/31/trivial-detail-in-facebook-messenger/">trivial detail in facebook messenger</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/23/csdn-password-leak-under/">密码泄漏事件下的冰山</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/12/19/question-to-a-startup-team/">Question to a Startup Team</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/30/digest/">Digest</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/08/nc-and-tar-play-nice-then/">nc and tar play nice then</a>
      </li>
    
      <li class="post">
        <a href="/blog/2011/11/01/hao-xi-guan/">好习惯</a>
      </li>
    
  </ul>
</section>


<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("boostguy", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/boostguy" class="twitter-follow-button" data-show-count="false">Follow @boostguy</a>
  
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Ken -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'heartoutside';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://log.heartoutside.com/blog/2011/05/10/mobile-phone-website-ultimate-optimization/';
        var disqus_url = 'http://log.heartoutside.com/blog/2011/05/10/mobile-phone-website-ultimate-optimization/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
